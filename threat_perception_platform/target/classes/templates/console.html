<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>控制台主页</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <!--引入本地layui.css-->
  <link rel="stylesheet" href="/layui/css/layui.css" media="all">
  <!--引入本地自定义的admin、login.css-->
  <link rel="stylesheet" href="/layui/layuiAdmin/css/admin.css" media="all">
  <!-- 引入刚刚下载的 ECharts 文件 -->
  <script src="/js/echarts.min.js"></script>
</head>
<body>

<div class="layui-fluid">
  <div class="layui-row layui-col-space15">
    <div class="layui-col-md8">
      <div class="layui-card">
        <div class="layui-card-header">操作系统类型</div>
        <div class="layui-card-body">
          <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
          <div id="pie" style="width: 100%; height: 400px;"></div>
        </div>
      </div>

      <div class="layui-card">
        <div class="layui-card-header">数据概览</div>
        <div class="layui-card-body">
          <!-- 为 ECharts 准备一个定义了宽高的 DOM -->
          <div id="bar" style="width: 100%; height: 400px;"></div>
        </div>
      </div>
    </div>

    <div class="layui-col-md4">
      <div class="layui-card notification">
        <div class="layui-card-header">用户活动</div>
        <div class="layui-card-body layui-text">
          <ul class="layui-timeline">
            <li class="layui-timeline-item">
              <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
              <div class="layui-timeline-content layui-text">
                <h3 class="layui-timeline-title">2024年6月24日</h3>
                <p>用户A完成了系统更新</p>
              </div>
            </li>
            <li class="layui-timeline-item">
              <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
              <div class="layui-timeline-content layui-text">
                <h3 class="layui-timeline-title">2024年6月23日</h3>
                <p>用户B修复了漏洞检测</p>
              </div>
            </li>
            <li class="layui-timeline-item">
              <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
              <div class="layui-timeline-content layui-text">
                <h3 class="layui-timeline-title">2024年6月22日</h3>
                <p>用户C更新了安全补丁</p>
              </div>
            </li>
            <li class="layui-timeline-item">
              <i class="layui-icon layui-timeline-axis">&#xe63f;</i>
              <div class="layui-timeline-content layui-text">
                <h3 class="layui-timeline-title">2024年6月21日</h3>
                <p>用户D完成了软件资产更新</p>
              </div>
            </li>
          </ul>
        </div>
      </div>

      <div class="layui-card">
        <div class="layui-card-header">通知</div>
        <div class="layui-card-body">
          <div class="layui-carousel layadmin-carousel layadmin-backlog">
            <div carousel-item>
              <ul class="layui-row layui-col-space10">
                <li class="layui-col-xs12">
                  <a href="javascript:;" class="layadmin-backlog-body">
                    <h3>系统升级通知</h3>
                    <p>2024年6月20日系统将进行升级维护，请提前做好相关准备。</p>
                  </a>
                </li>
                <li class="layui-col-xs12">
                  <a href="javascript:;" class="layadmin-backlog-body">
                    <h3>安全漏洞提醒</h3>
                    <p>近期发现多个高危漏洞，请及时修复。</p>
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<script type="text/javascript" src="/layui/layui.js"></script>
<script src="/js/jquery-3.7.1.min.js"></script>

<script type="text/javascript">
  // 操作系统类型（饼图）
  var myChartOs = echarts.init(document.getElementById('pie'));
  $.ajax({
    url: '/console/host',
    type: 'GET', // 或者 'POST'
    dataType: 'json', // 预期服务器返回的数据类型
    headers: {
      'Content-Type': 'application/json',
      'Authorization': localStorage.getItem('token')
    },
    success: function (data) {
      var osTypeWindows = 0;
      var osTypeLinux = 0;
      var osTypeMac = 0;

      for (var i = 0; i < data.data.length; i++) {
        if (data.data[i].osType === 'Windows') {
          osTypeWindows++;
        } else if (data.data[i].osType === 'Linux') {
          osTypeLinux++;
        } else if (data.data[i].osType === 'Mac') {
          osTypeMac++;
        }
      }

      // 指定图表的配置项和数据
      var option = {
        color: ['#FFB800', '#5FB878', '#409EFF'], // 设置饼图颜色
        legend: {
          top: 'bottom'
        },
        toolbox: {
          show: true,
          feature: {
            mark: { show: true },
            dataView: { show: true, readOnly: false },
            restore: { show: true },
            saveAsImage: { show: true }
          }
        },
        series: [
          {
            name: 'Nightingale Chart',
            type: 'pie',
            radius: [20, 100],
            center: ['45%', '40%'],
            label: {
              show: true,
              position: 'outside',
              formatter: '{b}: {c} ({d}%)',
              fontsize: 12
            },
            roseType: 'area',
            itemStyle: {
              borderRadius: 8
            },
            data: [
              { value: osTypeWindows, name: 'Windows' },
              { value: osTypeMac, name: 'Mac' },
              { value: osTypeLinux, name: 'Linux' },
            ]
          }
        ]
      };
      // 使用刚指定的配置项和数据显示图表。
      myChartOs.setOption(option);
    },
    error: function (jqXHR, textStatus, errorThrown) {
      console.error('Error: ' + textStatus + ', ' + errorThrown);
    }
  });

  // 漏洞影响统计图（柱状图）
  var myChartVul = echarts.init(document.getElementById('bar'));
  $.ajax({
    url: '/console/vul',
    type: 'GET', // 或者 'POST'
    dataType: 'json', // 预期服务器返回的数据类型
    headers: {
      'Content-Type': 'application/json',
      'Authorization': localStorage.getItem('token')
    },
    success: function (responseData) {
      // 初始化一个对象来计数每种漏洞类型的数量
      var vulTypeCounts = {};
      // 遍历返回的数据，统计漏洞类型
      responseData.data.forEach(function(vul) {
        if (!vulTypeCounts[vul.vulType]) {
          vulTypeCounts[vul.vulType] = 0;
        }
        vulTypeCounts[vul.vulType]++;
      });
      // 准备x轴数据（漏洞类型）和y轴数据（主机数）
      var xAxisData = Object.keys(vulTypeCounts);
      var seriesData = xAxisData.map(function(type) {
        return vulTypeCounts[type];
      });
      // 指定图表的配置项和数据
      var option = {
        color: ['#5FB878'], // 设置柱状图颜色
        title: {
          text: '漏洞影响统计图'
        },
        tooltip: {},
        legend: {
          data: ['主机数']
        },
        xAxis: {
          data: xAxisData
        },
        yAxis: {
          max: 10
        },
        series: [
          {
            name: '主机数',
            type: 'bar',
            data: seriesData
          }
        ]
      };
      // 使用刚指定的配置项和数据显示图表。
      myChartVul.setOption(option);
    },
    error: function (jqXHR, textStatus, errorThrown) {
      console.error('Error: ' + textStatus + ', ' + errorThrown);
    }
  });

</script>
</body>
</html>
